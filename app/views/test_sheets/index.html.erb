<div class="bg-kiosk min-h-screen py-12 px-8">
  <div class="max-w-6xl mx-auto">

    <!-- ========== Header ========== -->
    <div class="text-center mb-14">
      <div class="glass-card-static inline-block px-10 py-5 mb-6">
        <div class="text-5xl">🖨️</div>
      </div>

      <h1 class="heading-kiosk-1 mb-4">
        印刷履歴
      </h1>
      <p class="text-kiosk-body text-xl">過去に作成したテストの一覧</p>
    </div>

    <!-- ========== Stats Summary ========== -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
      <!-- Total Tests -->
      <div class="glass-card p-8 text-center">
        <div class="text-5xl mb-4">📚</div>
        <div class="text-4xl font-black mb-2" style="color: var(--accent-blue);">
          <%= TestSheet.count %>
        </div>
        <div class="text-xl font-bold" style="color: var(--text-light);">
          総テスト数
        </div>
      </div>

      <!-- Printed Tests -->
      <div class="glass-card p-8 text-center">
        <div class="text-5xl mb-4">✅</div>
        <div class="text-4xl font-black mb-2" style="color: var(--accent-green);">
          <%= TestSheet.where.not(printed_at: nil).count %>
        </div>
        <div class="text-xl font-bold" style="color: var(--text-light);">
          印刷済み
        </div>
      </div>

      <!-- Unprinted Tests -->
      <div class="glass-card p-8 text-center">
        <div class="text-5xl mb-4">⏳</div>
        <div class="text-4xl font-black mb-2" style="color: var(--text-light);">
          <%= TestSheet.where(printed_at: nil).count %>
        </div>
        <div class="text-xl font-bold" style="color: var(--text-light);">
          未印刷
        </div>
      </div>
    </div>

    <!-- ========== History List ========== -->
    <% if @test_sheets.any? %>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
        <% @test_sheets.each do |sheet| %>
          <div class="glass-card p-8 history-card">

            <!-- Subject Icon & Title -->
            <div class="flex items-center gap-5 mb-6">
              <div class="text-6xl flex-shrink-0">
                <%= subject_icon(sheet.subject) %>
              </div>
              <div class="flex-1">
                <p class="text-2xl font-black mb-1" style="color: var(--text-strong);">
                  <%= sheet.subject.name %>
                </p>
                <p class="text-xl font-semibold" style="color: var(--text-light);">
                  <%= sheet.unit.name %>
                </p>
              </div>
              <% if sheet.printed? %>
                <div class="text-3xl">✅</div>
              <% else %>
                <div class="text-3xl opacity-30">⏳</div>
              <% end %>
            </div>

            <!-- Details -->
            <div class="space-y-3 mb-8 text-lg" style="color: var(--text-light);">
              <div class="flex justify-between">
                <span class="font-semibold">問題数:</span>
                <span class="font-bold" style="color: var(--accent-blue);">
                  <%= sheet.question_count %>問
                </span>
              </div>
              <div class="flex justify-between">
                <span class="font-semibold">難易度:</span>
                <span class="font-bold">
                  <%= difficulty_label_for_display(sheet) %>
                </span>
              </div>
              <div class="flex justify-between">
                <span class="font-semibold">ヒント:</span>
                <span><%= sheet.include_hint? ? "✅ あり" : "❌ なし" %></span>
              </div>
              <div class="flex justify-between">
                <span class="font-semibold">解答:</span>
                <span><%= sheet.include_answer? ? "✅ あり" : "❌ なし" %></span>
              </div>
              <div class="pt-3 border-t border-gray-300">
                <div class="text-base" style="color: var(--text-light);">
                  <%= format_test_created_at(sheet) %> 作成
                </div>
                <% if sheet.printed? %>
                  <div class="text-base" style="color: var(--accent-green);">
                    <%= format_printed_at(sheet) %> 印刷
                  </div>
                <% end %>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="grid grid-cols-2 gap-4">
              <!-- View/Reprint -->
              <%= link_to test_sheet_path(sheet),
                  data: { turbo: false },
                  class: "btn-neo btn-neo-green text-center py-5 text-xl font-bold" do %>
                🔄 再印刷
              <% end %>

              <!-- Delete -->
              <%= link_to test_sheet_path(sheet),
                  data: { 
                    turbo_method: :delete,
                    turbo_confirm: "このテストを削除しますか？"
                  },
                  class: "history-delete-btn text-center py-5 text-xl font-bold" do %>
                🗑️ 削除
              <% end %>
            </div>

          </div>
        <% end %>
      </div>

      <!-- Pagination -->
      <% if @test_sheets.respond_to?(:total_pages) && @test_sheets.total_pages > 1 %>
        <div class="glass-card p-6 text-center mb-12">
          <%= paginate @test_sheets %>
        </div>
      <% end %>

    <% else %>
      <!-- Empty State -->
      <div class="glass-card p-16 text-center mb-12">
        <div class="text-8xl mb-8">📝</div>
        <h2 class="heading-kiosk-2 mb-4">テストがまだありません</h2>
        <p class="text-kiosk-body mb-8 text-xl">
          最初のテストを作成しましょう
        </p>
        <%= link_to step1_test_sheets_path,
            class: "btn-neo btn-neo-green inline-block",
            data: { turbo: false } do %>
          🚀 テストを作成する
        <% end %>
      </div>
    <% end %>

    <!-- ========== Back Button ========== -->
    <div class="text-center mt-8">
      <%= link_to root_path,
          class: "btn-neo btn-neo-secondary inline-block max-w-md",
          data: { turbo: false } do %>
        ⬅️ ホームに戻る
      <% end %>
    </div>

  </div>
</div>
