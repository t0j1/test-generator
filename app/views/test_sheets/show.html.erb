<div class="bg-kiosk">
  <div class="max-w-3xl mx-auto py-16 px-8 text-center">

    <!-- ========== Success Icon ========== -->
    <div class="glass-card-static mx-auto mb-10 inline-flex items-center justify-center show-success-icon">
      <div class="text-8xl">✅</div>
    </div>

    <!-- ========== Main Message ========== -->
    <h1 class="heading-kiosk-1 mb-6">
      テスト作成完了！
    </h1>

    <p class="text-kiosk-body mb-16 text-2xl">
      印刷ボタンを押してプリンターから用紙をお受け取りください
    </p>

    <!-- ========== Test Summary ========== -->
    <div class="glass-card p-10 mb-12">
      <h2 class="heading-kiosk-2 mb-8">📋 テスト内容</h2>
      
      <div class="grid grid-cols-2 gap-6 text-left">
        <div class="setting-item">
          <div class="setting-label">📚 科目</div>
          <div class="show-summary-value">
            <%= subject_icon(@test_sheet.subject) %> <%= @test_sheet.subject.name %>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">📖 単元</div>
          <div class="show-summary-value">
            <%= @test_sheet.unit.name %>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">🔢 問題数</div>
          <div class="show-summary-value-accent">
            <%= @test_sheet.question_count %>問
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">📊 難易度</div>
          <div class="show-summary-value">
            <%= difficulty_label_for_display(@test_sheet) %>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== Print Button ========== -->
    <div class="mb-12" data-controller="print">
      <button 
        data-action="click->print#executeAll"
        class="btn-neo btn-neo-green mb-8 show-print-button">
        🖨️ 印刷する
      </button>
    </div>

    <!-- ========== Action Buttons ========== -->
    <div class="space-y-6">
      <%= link_to step2_test_sheets_path(subject_id: @test_sheet.subject_id),
          class: "btn-neo btn-neo-secondary mb-4",
          data: { turbo: false } do %>
        ⬅️ 単元選択に戻る
      <% end %>

      <%= link_to step1_test_sheets_path,
          class: "btn-neo btn-neo-green",
          data: { turbo: false } do %>
        📚 続けてテストを作成する
      <% end %>

      <%= link_to root_path,
          class: "btn-neo btn-neo-secondary",
          data: { turbo: false } do %>
        🏠 ホームに戻る
      <% end %>
    </div>

  </div>
</div>

<!-- ========== Print Sheet (Hidden on screen, visible when printing) ========== -->
<div id="print-sheet" class="print-section">
  <div class="print-compact-sheet">
      <!-- ヘッダー -->
      <div class="print-compact-header">
        <div class="print-compact-title">
          [1～<%= @test_sheet.question_count %>] 
          <%= @test_sheet.created_at.strftime('%-m/%d') %><%= @test_sheet.subject.name %>
          <span class="print-name-label">名前：</span>
          <span class="print-name-line"></span>
        </div>
      </div>

      <!-- 4列テーブル -->
      <table class="print-compact-table">
        <tbody>
          <% 
            # 問題を2列に分割（左右に配置）
            half = (@test_sheet.question_count / 2.0).ceil
            left_questions = @questions[0...half]
            right_questions = @questions[half..-1] || []
            
            left_questions.each_with_index do |left_q, index|
              right_q = right_questions[index]
          %>
            <tr>
              <!-- 左列: 番号 -->
              <td class="print-compact-cell-number">
                <%= left_q.question_order %>
              </td>
              
              <!-- 左列: 単語 -->
              <td class="print-compact-cell-word">
                <%= left_q.question.question_text %>
              </td>
              
              <!-- 右列: 番号 -->
              <td class="print-compact-cell-number">
                <%= right_q ? right_q.question_order : '' %>
              </td>
              
              <!-- 右列: 単語 -->
              <td class="print-compact-cell-word">
                <%= right_q ? right_q.question.question_text : '' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <!-- QRコード（テーブル下） -->
      <div class="print-compact-qr">
        <%= image_tag "https://api.qrserver.com/v1/create-qr-code/?size=60x60&data=#{test_sheet_url(@test_sheet)}", 
                      alt: "QRコード" %>
        <div class="print-qr-label">解答確認用</div>
      </div>
    </div>
  </div>
</div>
