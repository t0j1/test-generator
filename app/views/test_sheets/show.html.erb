<div class="bg-kiosk">
  <div class="max-w-3xl mx-auto py-16 px-8 text-center">

    <!-- ========== Success Icon ========== -->
    <div class="glass-card-static mx-auto mb-10 inline-flex items-center justify-center" style="width:220px; height:220px;">
      <div class="text-8xl">âœ…</div>
    </div>

    <!-- ========== Main Message ========== -->
    <h1 class="heading-kiosk-1 mb-6">
      ãƒ†ã‚¹ãƒˆä½œæˆå®Œäº†ï¼
    </h1>

    <p class="text-kiosk-body mb-16 text-2xl">
      å°åˆ·ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã‹ã‚‰ç”¨ç´™ã‚’ãŠå—ã‘å–ã‚Šãã ã•ã„
    </p>

    <!-- ========== Test Summary ========== -->
    <div class="glass-card p-10 mb-12">
      <h2 class="heading-kiosk-2 mb-8">ğŸ“‹ ãƒ†ã‚¹ãƒˆå†…å®¹</h2>
      
      <div class="grid grid-cols-2 gap-6 text-left">
        <div class="setting-item">
          <div class="setting-label">ğŸ“š ç§‘ç›®</div>
          <div class="text-2xl font-bold" style="color: var(--text-strong);">
            <%= subject_icon(@test_sheet.subject) %> <%= @test_sheet.subject.name %>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">ğŸ“– å˜å…ƒ</div>
          <div class="text-2xl font-bold" style="color: var(--text-strong);">
            <%= @test_sheet.unit.name %>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">ğŸ”¢ å•é¡Œæ•°</div>
          <div class="text-2xl font-bold" style="color: var(--accent-blue);">
            <%= @test_sheet.question_count %>å•
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-label">ğŸ“Š é›£æ˜“åº¦</div>
          <div class="text-2xl font-bold" style="color: var(--text-strong);">
            <%= difficulty_label_for_display(@test_sheet) %>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== Print Button ========== -->
    <div class="mb-12" data-controller="print">
      <button 
        data-action="click->print#executeAll"
        class="btn-neo btn-neo-green mb-8"
        style="font-size: 2rem; padding: 2rem 4rem;">
        ğŸ–¨ï¸ å°åˆ·ã™ã‚‹
      </button>
    </div>

    <!-- ========== Action Buttons ========== -->
    <div class="space-y-6">
      <%= link_to step1_test_sheets_path,
          class: "btn-neo btn-neo-green",
          data: { turbo: false } do %>
        ğŸ“š ç¶šã‘ã¦ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹
      <% end %>

      <%= link_to root_path,
          class: "btn-neo btn-neo-secondary",
          data: { turbo: false } do %>
        ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
      <% end %>
    </div>

  </div>
</div>

<!-- ========== Print Sheet (Hidden on screen, visible when printing) ========== -->
<div id="print-sheet" class="print-section">
  <div class="print-compact-sheet">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="print-compact-header">
        <div class="print-compact-title">
          [1ï½<%= @test_sheet.question_count %>] 
          <%= @test_sheet.created_at.strftime('%-m/%d') %><%= @test_sheet.subject.name %>
          <span style="margin-left: 2rem;">åå‰ï¼š</span>
          <span style="display: inline-block; width: 200px; border-bottom: 1px solid #000; margin-left: 0.5rem;"></span>
        </div>
      </div>

      <!-- 4åˆ—ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <table class="print-compact-table">
        <tbody>
          <% 
            # å•é¡Œã‚’2åˆ—ã«åˆ†å‰²ï¼ˆå·¦å³ã«é…ç½®ï¼‰
            half = (@test_sheet.question_count / 2.0).ceil
            left_questions = @questions[0...half]
            right_questions = @questions[half..-1] || []
            
            left_questions.each_with_index do |left_q, index|
              right_q = right_questions[index]
          %>
            <tr>
              <!-- å·¦åˆ—: ç•ªå· -->
              <td class="print-compact-cell-number">
                <%= left_q.question_order %>
              </td>
              
              <!-- å·¦åˆ—: å˜èª -->
              <td class="print-compact-cell-word">
                <%= left_q.question.question_text %>
              </td>
              
              <!-- å³åˆ—: ç•ªå· -->
              <td class="print-compact-cell-number">
                <%= right_q ? right_q.question_order : '' %>
              </td>
              
              <!-- å³åˆ—: å˜èª -->
              <td class="print-compact-cell-word">
                <%= right_q ? right_q.question.question_text : '' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <!-- QRã‚³ãƒ¼ãƒ‰ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä¸‹ï¼‰ -->
      <div class="print-compact-qr">
        <%= image_tag "https://api.qrserver.com/v1/create-qr-code/?size=60x60&data=#{test_sheet_url(@test_sheet)}", 
                      alt: "QRã‚³ãƒ¼ãƒ‰", 
                      style: "width: 60px; height: 60px;" %>
        <div style="font-size: 9px; margin-top: 2px;">è§£ç­”ç¢ºèªç”¨</div>
      </div>
    </div>
  </div>
</div>

<style>
/* ========== ç”»é¢è¡¨ç¤ºæ™‚ã¯éè¡¨ç¤º ========== */
@media screen {
  #print-sheet {
    display: none !important;
  }
}

/* ========== å°åˆ·æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« ========== */
@media print {
  /* ç”»é¢è¦ç´ ã‚’éè¡¨ç¤º */
  .bg-kiosk,
  nav,
  header,
  footer {
    display: none !important;
  }
  
  /* å°åˆ·ç”¨è¦ç´ ã‚’è¡¨ç¤º */
  #print-sheet {
    display: block !important;
  }
  
  /* ä½™ç™½è¨­å®š */
  @page {
    margin: 15mm;
    size: A4 portrait;
  }
  
  body {
    margin: 0;
    padding: 0;
    background: white;
  }
  
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }
}

/* ========== ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆå°åˆ·ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ========== */
.print-compact-sheet {
  width: 100%;
  max-width: 210mm;
  margin: 0 auto;
  padding: 20px;
  font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
  position: relative;
  background: white;
  color: black;
}

.print-compact-header {
  border: 2px solid #000 !important;
  padding: 10px 15px !important;
  margin-bottom: 2px;
  background: white !important;
  page-break-inside: avoid;
}

.print-compact-title {
  font-size: 16px !important;
  font-weight: bold !important;
  text-align: left;
  color: black !important;
  line-height: 1.5;
}

.print-compact-table {
  width: 100%;
  border-collapse: collapse;
  border: 2px solid #000 !important;
  background: white !important;
  table-layout: fixed;
}

.print-compact-table tbody {
  background: white !important;
}

.print-compact-table tr {
  page-break-inside: avoid;
}

.print-compact-table td {
  border: 1px solid #000 !important;
  padding: 8px 10px !important;
  vertical-align: middle;
  color: black !important;
  background: white !important;
}

.print-compact-cell-number {
  width: 8%;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}

.print-compact-cell-word {
  width: 42%;
  text-align: left;
  font-size: 14px;
}

.print-compact-qr {
  margin-top: 15px;
  text-align: left;
  padding-left: 10px;
}

.print-compact-qr img {
  display: inline-block;
  margin-bottom: 2px;
}
</style>
